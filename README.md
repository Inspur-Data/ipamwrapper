# k8-ipam

## 介绍

k8-ipam是一个 kubernetes 网络项目， 其设计目标是能够作为所有主流CNI插件的IPAM（如Calico、Cilium、Kube-OVN等），并提供丰富的功能来实现对这些CNI插件原有IP管理能力的增强。
基于K8S的云平台通常支持多个CNI插件，比如Calico/Kube-OVN/Cilium等，这些插件实现方案不同，功能、性能也有差异，能够满足不同场景的需求。但多CNI插件也带来了技术栈广、运维和升级复杂的问题，对于云平台开发和运维人员带来了很大的技术挑战，也在一定程度上制约了云平台去兼容使用更多的CNI插件。为优化上述问题，我们基于广泛的生产场景分析，以及在CNCF社区相关项目上持续跟进获得的技术积累，提出分层解耦的方案去统一各CNI插件中与差异技术无关的功能模块，从而有效减小技术复杂度，为用户带来统一的功能体验。k8-ipam即是在这一思想指导下开发实现的多CNI统一IP管理模块。
k8-ipam基于kubernetes CRD进行管理，同时其也提供插件化扩展机制，在其基础上能够集成其他多CNI统一功能解决方案，比如Calico/Kube-OVN/Cilium都用到的BGP能力等。

## 关键功能

| 功能          | 描述                                                         | 实现程度 |
| :------------ | ------------------------------------------------------------ | -------- |
| 应用固定IP    | 对于无状态应用，可实现固定IP范围，并且能根据应用的副本数进行IP资源池的自动扩缩容；对于有状态应用，可实现每个Pod固定IP地址，同时支持有状态应用副本扩缩容 | 暂未实现 |
| IPv4/IPv6双栈 | 支持为Pod分配IPv4和IPv6双栈地址，满足云原生双栈场景          | 暂未实现 |
| VPC           | 支持创建自定义VPC, 每个子网隶属于一个VPC, VPC存储子网的公共属性   | 暂未实现 |
| 子网          | 支持创建自定义子网，并支持子网与命名空间绑定，在绑定了子网的命名空间内创建应用时，IP将在绑定的子网内分配IP | 暂未实现 |
| 定制化路由    | 支持自定义路由功能，用户自行规划路由规则并通过参数传入IPAM，后续创建出的Pod内即可带有自定义的路由信息 | 暂未实现 |
| 预留IP        | 支持预留IP功能，预留IP的生效范围为整个集群，在预留IP内指定的IP将不会被分配，保证IP不会 | 暂未实现 |



## 架构

 ![](./docs/images/架构图.png)

如上架构图所示，k8-ipam主要由三个部分构成：

- k8-ipam：安装在每个节点上的二进制文件，被存放在/opt/cni/bin路径下，提供了标准接口cmdAdd和cmdDel，当被kubelet调用时在二进制内只会组装相关参数并发起http请求，真正分配IP和释放IP的操作在k8-ipam-ds内实现
- k8-ipam-ds：以daemonset形式部署在集群内每个节点上，负责IP的申请、释放等具体功能，并通过http-server对外提供服务，供k8-ipam调用
- k8-ipam-controller：以deployment形式部署在集群内，如果是多副本则需要有选主操作。主要通过调谐使集群内IPAM相关资源达到预期状态，并负责资源的清理及回收操作，另外还通过webhook机制实现一些权限校验等操作

## 快速搭建

参考[快速搭建](./docs/install.md)

## RoadMap

参考[roadmap](roadmap.md)

## 样例



## 联系我们

 - 我们来自浪潮云海k8s开发团队

 - 欢迎有想法的小伙伴参与此项目中

   
